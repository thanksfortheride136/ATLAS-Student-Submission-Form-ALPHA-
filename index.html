<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    /* General body styles */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #2c2c2c;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
    }

    /* Header branding for ATLAS */
    .atlas-header {
      text-align: center;
      background-color: #ff8800;
      padding: 20px;
      color: white;
      width: 100%;
      position: absolute;
      top: 0;
    }

    .atlas-header h1 {
      font-family: 'Georgia', serif;
      font-size: 32px;
      margin: 0;
    }

    .atlas-header p {
      font-family: 'Arial', sans-serif;
      font-size: 14px;
      margin: 5px 0 0;
    }

    /* Container to center the form */
    .form-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    /* Form container */
    .form-container {
      width: 100%;
      max-width: 500px;
      padding: 30px;
      background-color: #3a3a3a;
      border-radius: 8px;
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
    }

    /* Form title */
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #ff8800;
      font-family: 'Georgia', serif;
      font-size: 24px;
    }

    /* Label styling */
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #cccccc;
      font-size: 16px;
    }

    /* Input and select elements */
    input, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #555;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
      background-color: #4a4a4a;
      color: white;
    }

    /* File upload styling */
    input[type="file"] {
      padding: 5px;
      font-size: 14px;
    }

    /* Button styling */
    button {
      width: 100%;
      padding: 12px;
      background-color: #ff8800;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Arial', sans-serif;
      transition: background-color 0.3s ease;
    }

    button:disabled {
      background-color: #9e9e9e;
    }

    button:hover {
      background-color: #e67300;
    }

    /* Success and error messages */
    .message {
      margin-top: 10px;
      color: #66ff66;
      text-align: center;
    }

    .error {
      color: red;
      margin-top: 10px;
      text-align: center;
    }

    /* Footer branding */
    .footer {
      text-align: center;
      font-size: 12px;
      color: #cccccc;
      margin-top: 10px;
    }

    /* Responsive design */
    @media (max-width: 600px) {
      .form-container {
        padding: 20px;
      }

      input, select, button {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <!-- ATLAS Branding Header -->
  <div class="atlas-header">
    <h1>ATLAS</h1>
    <p>A Technology Learning Aid System</p>
  </div>

  <!-- Centered form wrapper -->
  <div class="form-wrapper">
    <div class="form-container">
      <h2>File Submission Form</h2>

      <form id="submissionForm">
        <!-- Class Name Dropdown -->
        <label for="className">Class Name:</label>
        <select id="className" name="className" required onchange="populateStudentNames()">
          <option value="">-- Select Class --</option>
          <option value="AP Computer Science Principles">AP Computer Science Principles</option>
          <option value="Engineering 1 (Period 3)">Engineering 1 (Period 3)</option>
          <option value="Engineering 1 (Period 7)">Engineering 1 (Period 7)</option>
          <option value="Engineering 2">Engineering 2</option>
          <option value="STEM 8">STEM 8</option>
        </select>

        <!-- Student Name Dropdown (populated dynamically) -->
        <label for="studentName">Student Name:</label>
        <select id="studentName" name="studentName" required>
          <option value="">-- Select Student --</option>
        </select>

        <!-- Project Name Dropdown -->
        <label for="projectName">Project Name:</label>
        <select id="projectName" name="projectName" required>
          <option value="">-- Select Project --</option>
          <option value="Kalimba">Kalimba</option>
          <option value="Ukulele">Ukulele</option>
          <option value="Arbor Press">Arbor Press</option>
        </select>

        <!-- File Upload -->
        <label for="fileUpload">Upload Files:</label>
        <input type="file" id="fileUpload" name="files" multiple required>

        <div id="fileReadyMessage" class="message"></div>

        <!-- Submit Button -->
        <button type="button" id="submitButton" onclick="submitForm()">Submit</button>
      </form>

      <!-- Output for Success/Error Messages -->
      <div id="output" class="message"></div>

      <!-- Footer Branding -->
      <div class="footer">
        Â© 2024 ATLAS - A Technology Learning Aid System
      </div>
    </div>
  </div>

  <script>
    // Predefined student lists for each class
    const studentData = {
      "AP Computer Science Principles": ["Erica Colabella", "Yadiel De La Mota", "Colin Djurkinjak", "Elizabeth Gjelaj", "Victoria Gjelaj", "Vincent Handy", 
      "Grace Kern", "Sophia Marku", "Gregory McCormack", "James Peters", "Chloe Piedmont", "Dylan Rigby", "Maya Sarma"],
      "Engineering 1 (Period 3)": ["Adri Azemi", "Amiya Bah", "Mason Bogetti", "Jack Carinci", "Anthony Cermele", "Jenna Chen",
       "Ariel Genao", "Justin Gjekaj", "Caden Goldberg", "Riku Katsuno", "Zakary Simpson"],
      "Engineering 1 (Period 7)": ["Gianni Addeo", "Tommy Camejo", "Isabella Carinci", "Giovanni Del Mistro", "Lily Fleming", "Erin Gerken", 
      "Dean Goldstein", "Emiliano Hernandez-Ferro", "Andrew Kubaska", "Cameron Ly", "Ephraim Mironchuk", "Dominic Restifo", "Aniya Shaw", "Mishel Syed"],
      "Engineering 2": ["Gavin Barreno", "Lucas Hofflich", "Jon Ludi", "Santiago Ortega-Brown", "Luciana Vasquez", "Leila Garguilo"],
      "STEM 8": ["Steve Rogers", "Bucky Barnes", "Sam Wilson"]
    };

    // Function to populate student names based on class selection
    function populateStudentNames() {
      const className = document.getElementById('className').value;
      const studentDropdown = document.getElementById('studentName');
      
      // Clear any previous student names
      studentDropdown.innerHTML = '<option value="">-- Select Student --</option>';

      if (className && studentData[className]) {
        const students = studentData[className];
        students.forEach(student => {
          const option = document.createElement('option');
          option.value = student;
          option.textContent = student;
          studentDropdown.appendChild(option);
        });
      }
    }

    // Show a message when files are selected
    document.getElementById('fileUpload').addEventListener('change', function(event) {
      const files = event.target.files;
      if (files.length > 0) {
        document.getElementById('fileReadyMessage').innerHTML = files.length + ' file(s) selected. Ready to submit!';
      } else {
        document.getElementById('fileReadyMessage').innerHTML = '';
      }
    });

    // Form submission
    function submitForm() {
      // Clear any previous error message
      document.getElementById('output').innerHTML = '';

      // Get values of form fields
      const studentName = document.getElementById('studentName').value;
      const className = document.getElementById('className').value;
      const projectName = document.getElementById('projectName').value;
      const files = document.getElementById('fileUpload').files;

      // Validate all fields
      if (!studentName || !className || !projectName || files.length === 0) {
        document.getElementById('output').innerHTML = 'Please fill out all fields and select a file.';
        return;
      }

      // Disable submit button to prevent multiple clicks
      const submitButton = document.getElementById('submitButton');
      submitButton.disabled = true;
      submitButton.innerHTML = 'Submitting...';

      // Prepare data for Apps Script
      const formData = {
        studentName: studentName,
        className: className,
        projectName: projectName,
        files: [] // Files will be converted later
      };

      // Convert file input to blobs and append to formData
      for (let i = 0; i < files.length; i++) {
        const reader = new FileReader();
        reader.onload = (function(file) {
          return function(e) {
            formData.files.push({
              name: file.name,
              data: e.target.result
            });

            if (formData.files.length === files.length) {
              google.script.run.withSuccessHandler(function(response) {
                // Show success message
                document.getElementById('output').innerHTML = response;
                
                // Clear form fields
                document.getElementById('submissionForm').reset();
                
                // Clear file ready message
                document.getElementById('fileReadyMessage').innerHTML = '';

                // Re-enable the submit button and reset text
                submitButton.disabled = false;
                submitButton.innerHTML = 'Submit';
              }).withFailureHandler(function(error) {
                // Show error message
                document.getElementById('output').innerHTML = 'Error: ' + error.message;

                // Re-enable the submit button in case of failure
                submitButton.disabled = false;
                submitButton.innerHTML = 'Submit';
              }).processForm(formData);
            }
          };
        })(files[i]);

        reader.readAsDataURL(files[i]);
      }
    }
  </script>
</body>
</html>
